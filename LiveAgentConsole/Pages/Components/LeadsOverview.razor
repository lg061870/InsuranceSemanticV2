@page "/leads"
@using LiveAgentConsole.Pages.Components
@using LiveAgentConsole.Services
@using LiveAgentConsole.ViewModels

@inject LeadService LeadService


<div class="min-h-screen flex flex-col text-gray-800">
    <Header />

    <main id="main-content" class="flex-1 p-6 max-w-[1600px] mx-auto w-full">
        <!-- Header & KPI Section -->
        <section id="kpi-dashboard" class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Lead Management</h2>
                    <p class="text-sm text-gray-500 mt-1">View, filter, and manage your insurance prospects.</p>
                </div>
                <div class="flex gap-3">
                    <button class="bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 px-4 py-2 rounded-lg text-sm font-medium shadow-sm transition-all flex items-center gap-2">
                        <i class="fa-solid fa-file-export"></i> Export CSV
                    </button>
                    <button class="bg-primary hover:bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-medium shadow-md transition-all flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i> Add New Lead
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <KPICard Icon="fa-users" IconBg="bg-blue-50" IconColor="text-primary" Title="Total Leads" Value="1,284" Trend="12% vs last week" TrendColor="text-green-600" />
                <KPICard Icon="fa-fire" IconBg="bg-green-50" IconColor="text-secondary" Title="Hot Leads" Value="142" Trend="5 new today" TrendColor="text-green-600" />
                <KPICard Icon="fa-clock-rotate-left" IconBg="bg-orange-50" IconColor="text-orange-500" Title="Follow-up Due" Value="28" Trend="4 overdue" TrendColor="text-red-500" />
                <KPICard Icon="fa-sack-dollar" IconBg="bg-purple-50" IconColor="text-purple-500" Title="Pipeline Value" Value="$2.4M" Trend="Est. Annual Premium" TrendColor="text-gray-500" />
            </div>
        </section>

        <!-- Filters & Leads Section -->
        <section id="leads-list-container" class="bg-white border border-gray-200 rounded-xl shadow-sm flex flex-col h-[650px]">
            <LeadFilters />

            <div class="grid grid-cols-12 gap-4 px-6 py-3 bg-gray-50 border-b border-gray-200 text-xs font-semibold text-gray-500 uppercase tracking-wider">
                <div class="col-span-3 flex items-center gap-3">
                    <input type="checkbox" class="checkbox-custom cursor-pointer">
                    <span>Lead Name</span>
                </div>
                <div class="col-span-2">Insurance Product</div>
                <div class="col-span-1 text-center">Score</div>
                <div class="col-span-1">Value</div>
                <div class="col-span-2">Status & Next Step</div>
                <div class="col-span-2">Source</div>
                <div class="col-span-1 text-right">Actions</div>
            </div>

            <div class="overflow-y-auto flex-1 bg-white">
                @foreach (var lead in Leads)
                {
                    <LeadRow Lead="lead" />
                }
            </div>

            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl flex items-center justify-between">
                <div class="text-sm text-gray-500">
                    Showing <span class="font-bold text-gray-800">1-5</span> of <span class="font-bold text-gray-800">1,284</span> leads
                </div>
                <Pagination CurrentPage="@currentPage"
                            PageCount="@totalPages"
                            OnPageChanged="HandlePageChanged" />

            </div>
        </section>
    </main>

    <button class="fixed bottom-8 right-8 w-14 h-14 bg-primary hover:bg-primaryDark text-white rounded-full shadow-lg hover:shadow-xl transition-all flex items-center justify-center z-40 group">
        <i class="fa-solid fa-plus text-xl group-hover:rotate-90 transition-transform duration-300"></i>
    </button>
</div>

@code {
    private List<LeadRowView> Leads = new();
    private int currentPage = 1;
    private int totalPages = 1; // compute based on total leads count and page size

    protected override async Task OnInitializedAsync()
    {
        // TODO: Load leads from API
        Leads = await LeadService.GetAllLeadsAsync();
    }

    private async Task HandlePageChanged(int newPage) {
        currentPage = newPage;
        Leads = await LeadService.GetAllLeadsAsync();
    }

}
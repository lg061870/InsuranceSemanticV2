@using ConversaCore.TopicFlow
@using InsuranceAgent.Extensions

<div id="my-information-panel" class="tab-content p-8 overflow-y-auto max-h-[85vh]">
    <div class="mb-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-2">My Information</h2>
        <p class="text-sm text-gray-600">Review and verify all information provided during the consultation process</p>
    </div>

    <div class="grid grid-cols-2 gap-6">

        <!-- Personal Information -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold text-gray-900 flex items-center">
                    <i class="fa-solid fa-user text-blue-600 mr-3"></i>
                    Personal Information
                </h3>
                <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                    <i class="fa-solid fa-pen mr-1"></i>Edit
                </button>
            </div>

            <div class="space-y-4">

                <!-- Full Name -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Full Name</p>
                        <p class="text-sm font-semibold text-gray-900">@GetValue("full_name")</p>
                    </div>
                </div>

                <!-- Date of Birth (placeholder — no data yet) -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Date of Birth</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretDob()</p>
                    </div>
                </div>

                <!-- Email -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Email Address</p>
                        <p class="text-sm font-semibold text-gray-900">@GetValue("email_address")</p>
                    </div>
                </div>

                <!-- Phone -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Phone Number</p>
                        <p class="text-sm font-semibold text-gray-900">@GetPhoneNumber("phone_number")</p>
                    </div>
                </div>

                <!-- Address (street, city, state, zip) -->
                <div class="flex items-start justify-between py-3">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Address</p>
                        <p class="text-sm font-semibold text-gray-900">@GetFormattedAddress()</p>
                    </div>
                </div>

            </div>
        </div>


        <!-- Employment & Financial -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold text-gray-900 flex items-center">
                    <i class="fa-solid fa-briefcase text-blue-600 mr-3"></i>
                    Employment &amp; Financial
                </h3>
                <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                    <i class="fa-solid fa-pen mr-1"></i>Edit
                </button>
            </div>

            <div class="space-y-4">
                <!-- Occupation -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Occupation</p>
                        <p class="text-sm font-semibold text-gray-900">@GetValue("occupation")</p>
                    </div>
                </div>

                <!-- Income Band -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Household Income</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretIncomeBand()</p>
                    </div>
                </div>

                <!-- Employment Status -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Employment Status</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretEmploymentStatus()</p>
                    </div>
                </div>

                <!-- Years Employed (NO FIELD YET → placeholder) -->
                <div class="flex items-start justify-between py-3">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Years Employed</p>
                        <p class="text-sm font-semibold text-gray-900">@GetValue("years_employed")</p>
                    </div>
                </div>
            </div>
        </div>


        <!-- Family Information -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold text-gray-900 flex items-center">
                    <i class="fa-solid fa-users text-blue-600 mr-3"></i>
                    Family Information
                </h3>
                <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                    <i class="fa-solid fa-pen mr-1"></i>Edit
                </button>
            </div>

            <div class="space-y-4">
                <!-- Marital Status -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Marital Status
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            @InterpretMaritalStatus()
                        </p>
                    </div>
                </div>

@*                 <!-- Spouse Name (NO FIELD YET) -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Spouse Name
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            N/A
                        </p>
                    </div>
                </div> *@

                <!-- Number of Dependents -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Number of Dependents
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            @GetValue("no_of_children")
                        </p>
                    </div>
                </div>

                <!-- Dependents Details -->
                <div class="flex items-start justify-between py-3">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Dependents Details
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            @InterpretDependentsDetails()
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Information -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold text-gray-900 flex items-center">
                    <i class="fa-solid fa-heart-pulse text-blue-600 mr-3"></i>
                    Health Information
                </h3>
                <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                    <i class="fa-solid fa-pen mr-1"></i>Edit
                </button>
            </div>

            <div class="space-y-4">

                <!-- Overall Health Status -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Overall Health Status</p>
                        <p class="text-sm font-semibold text-gray-900">@GetValue("overall_health_status")</p>
                    </div>
                </div>

                <!-- Tobacco -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Tobacco Use</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretTobaccoUse()</p>
                    </div>
                </div>

                <!-- Conditions -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Pre-existing Conditions</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretMedicalConditions()</p>
                    </div>
                </div>

                <!-- Current Medications -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Current Medications</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretMedications()</p>
                    </div>
                </div>

                <!-- Last Medical Exam (NO FIELD YET) -->
                <div class="flex items-start justify-between py-3">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Last Medical Exam</p>
                        <p class="text-sm font-semibold text-gray-900">N/A</p>
                    </div>
                </div>

            </div>
        </div>

        <!-- Insurance Needs & Goals -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold text-gray-900 flex items-center">
                    <i class="fa-solid fa-bullseye text-blue-600 mr-3"></i>
                    Insurance Needs &amp; Goals
                </h3>
                <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                    <i class="fa-solid fa-pen mr-1"></i>Edit
                </button>
            </div>

            <div class="space-y-4">

                <!-- Primary Goal -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Primary Goal</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretPrimaryGoal()</p>
                    </div>
                </div>

                <!-- Coverage Duration Preference -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Coverage Duration Preference</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretCoverageDuration()</p>
                    </div>
                </div>

                <!-- Desired Coverage Amount -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Desired Coverage Amount</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretCoverageAmount()</p>
                    </div>
                </div>

                <!-- Monthly Budget -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Monthly Budget</p>
                        <p class="text-sm font-semibold text-gray-900">@InterpretMonthlyBudget()</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Assets & Liabilities -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold text-gray-900 flex items-center">
                    <i class="fa-solid fa-home text-blue-600 mr-3"></i>
                    Assets &amp; Liabilities
                </h3>
                <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                    <i class="fa-solid fa-pen mr-1"></i>Edit
                </button>
            </div>

            <div class="space-y-4">

                <!-- Home Ownership -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Home Ownership
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            @InterpretHomeOwnership()
                        </p>
                    </div>
                </div>

                <!-- Home Equity -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Home Equity
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            @InterpretRange("home_equity_amount")
                        </p>
                    </div>
                </div>

                <!-- Mortgage Debt -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Mortgage Debt
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            @InterpretRange("mortgage_debt")
                        </p>
                    </div>
                </div>

                <!-- Other Debt -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Other Debt
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            @InterpretRange("other_debt")
                        </p>
                    </div>
                </div>

                <!-- Savings & Investments -->
                <div class="flex items-start justify-between py-3 border-b border-gray-100">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Savings &amp; Investments
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            @InterpretCombinedSavingsInvestments()
                        </p>
                    </div>
                </div>

                <!-- Retirement Accounts -->
                <div class="flex items-start justify-between py-3">
                    <div class="flex-1">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">
                            Retirement Accounts
                        </p>
                        <p class="text-sm font-semibold text-gray-900">
                            @InterpretRange("retirement_amount")
                        </p>
                    </div>
                </div>

            </div>
        </div>


    </div>

    <!-- Data Privacy (unchanged) -->
    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-xl p-6">
        <div class="flex items-start space-x-4">
            <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0">
                <i class="fa-solid fa-shield-halved text-white text-xl"></i>
            </div>
            <div class="flex-1">
                <h3 class="text-lg font-bold text-gray-900 mb-2">Data Privacy &amp; Security</h3>
                <p class="text-sm text-gray-700 mb-4">
                    All information provided is encrypted and stored securely in compliance with HIPAA, CCPA, and other relevant data protection regulations.
                    Your personal information will only be used for insurance underwriting and policy administration purposes.
                </p>

                <div class="flex space-x-3">
                    <button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-2.5 rounded-lg transition-colors text-sm">
                        <i class="fa-solid fa-download mr-2"></i>
                        Download My Data
                    </button>

                    <button class="bg-white hover:bg-gray-50 border border-gray-300 text-gray-700 font-semibold px-5 py-2.5 rounded-lg transition-colors text-sm">
                        <i class="fa-solid fa-file-lines mr-2"></i>
                        View Privacy Policy
                    </button>

                    <button class="bg-white hover:bg-gray-50 border border-gray-300 text-gray-700 font-semibold px-5 py-2.5 rounded-lg transition-colors text-sm">
                        <i class="fa-solid fa-trash mr-2"></i>
                        Request Data Deletion
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>


@code {
    [Parameter] public TopicWorkflowContext Context { get; set; } = default!;
    [Parameter] public string ActiveTab { get; set; } = "";

    // ============================================================
    // GENERIC HELPERS
    // ============================================================
    private string GetValue(string key) {
        try {
            var v = Context.GetValue<object>(key);
            if (v == null) return "N/A";
            var s = v.ToString();
            return string.IsNullOrWhiteSpace(s) ? "N/A" : s;
        } catch {
            return "N/A";
        }
    }

    private string GetVal(string key) => GetValue(key);

    private bool GetToggle(string key) {
        var v = GetValue(key).ToLower();
        return v == "true" || v == "yes";
    }

    private string GetFormattedAddress() {
        var street = GetValue("street_address");
        var city = GetValue("city");
        var state = GetValue("state");
        var zip = GetValue("zip_code");

        if (street == "N/A" || city == "N/A" || state == "N/A" || zip == "N/A")
            return "N/A";

        return $"{street}, {city}, {state} {zip}";
    }

    private string GetPhoneNumber(string key) {
        var raw = GetValue(key);
        if (raw == "N/A") return "N/A";

        var digits = new string(raw.Where(char.IsDigit).ToArray());

        if (digits.Length == 11 && digits.StartsWith("1"))
            digits = digits[1..];

        if (digits.Length != 10)
            return raw;

        return $"({digits[..3]}) {digits.Substring(3, 3)}-{digits.Substring(6, 4)}";
    }


    // ============================================================
    // EMPLOYMENT INTERPRETERS
    // ============================================================
    private string InterpretEmploymentStatus() {
        var raw = GetValue("employment_status");

        return raw switch {
            "Full-Time" => "Full-Time",
            "Part-Time" => "Part-Time",
            "Self-Employed" => "Self-Employed",
            "Retired" => "Retired",
            "Unemployed" => "Unemployed",
            "Student" => "Student",
            "Prefer not to say" => "Prefer not to say",
            _ => "N/A"
        };
    }

    private string InterpretIncomeBand() {
        var raw = GetValue("household_income");

        return raw switch {
            "Under $25k" => "Under $25k",
            "$25k–$50k" => "$25k–$50k",
            "$50k–$75k" => "$50k–$75k",
            "$75k–$100k" => "$75k–$100k",
            "Over $100k" => "Over $100k",
            "Prefer not to say" => "Prefer not to say",
            _ => "N/A"
        };
    }


    // ============================================================
    // DEPENDENTS / FAMILY INTERPRETERS
    // ============================================================
    private string InterpretMaritalStatus() {
        var raw = GetVal("marital_status");
        return raw == "N/A" ? "Not Provided" : raw;
    }

    private string InterpretDependentsCount() {
        var hasDep = GetVal("has_dependents").ToLower();

        if (hasDep == "no") return "0";
        if (hasDep != "yes") return "N/A";

        int count = 0;
        if (GetToggle("ageRange_0_5")) count++;
        if (GetToggle("ageRange_6_12")) count++;
        if (GetToggle("ageRange_13_17")) count++;
        if (GetToggle("ageRange_18_25")) count++;
        if (GetToggle("ageRange_25plus")) count++;

        return count == 0 ? "1" : count.ToString();
    }

    private string InterpretDependentsDetails() {
        var hasDep = GetVal("has_dependents").ToLower();

        if (hasDep == "no") return "None";
        if (hasDep != "yes") return "N/A";

        var ranges = new List<string>();

        if (GetToggle("ageRange_0_5")) ranges.Add("Ages 0–5");
        if (GetToggle("ageRange_6_12")) ranges.Add("Ages 6–12");
        if (GetToggle("ageRange_13_17")) ranges.Add("Ages 13–17");
        if (GetToggle("ageRange_18_25")) ranges.Add("Ages 18–25");
        if (GetToggle("ageRange_25plus")) ranges.Add("Ages 25+");

        return ranges.Count == 0 ? "Dependents (age unspecified)" : string.Join(", ", ranges);
    }


    // ============================================================
    // HEALTH INTERPRETERS
    // ============================================================
    private string InterpretTobaccoUse() {
        var raw = GetValue("tobacco_use").ToLower();

        return raw switch {
            "yes" => "Tobacco User",
            "no" => "Non-smoker",
            _ => "N/A"
        };
    }

    private string InterpretMedicalConditions() {
        var conditions = new List<string>();

        if (GetToggle("condition_diabetes")) conditions.Add("Diabetes");
        if (GetToggle("condition_heart")) conditions.Add("Heart Condition");
        if (GetToggle("condition_bp")) conditions.Add("High Blood Pressure");
        if (GetToggle("condition_none")) conditions.Add("None Apply");

        if (conditions.Count == 0) return "N/A";

        if (conditions.Contains("None Apply")) return "None Apply";

        return string.Join(", ", conditions);
    }

    private string InterpretMedications() {
        var raw = GetValue("current_medications");
        return raw == "N/A" ? "N/A" : raw;
    }


    // ============================================================
    // LIFE GOALS INTERPRETERS
    // ============================================================
    private string InterpretPrimaryGoal() {
        List<string> goals = new();

        if (GetToggle("intent_protect_loved_ones")) goals.Add("Protect Loved Ones");
        if (GetToggle("intent_pay_mortgage")) goals.Add("Pay Off Mortgage");
        if (GetToggle("intent_prepare_future")) goals.Add("Prepare for Family’s Future");
        if (GetToggle("intent_peace_of_mind")) goals.Add("Peace of Mind");
        if (GetToggle("intent_cover_expenses")) goals.Add("Cover Final Expenses");
        if (GetToggle("intent_unsure")) goals.Add("Unsure");

        return goals.Count == 0 ? "N/A" : string.Join(", ", goals);
    }


    // ============================================================
    // COVERAGE INTENT
    // ============================================================
    private string InterpretCoverageAmount() {
        return GetValue("coverage_amount") switch {
            "under_50k" => "Under $50k",
            "50k_100k" => "$50k–$100k",
            "100k_250k" => "$100k–$250k",
            "over_250k" => "Over $250k",
            "not_sure" => "Not Sure",
            _ => "N/A"
        };
    }


    // ============================================================
    // DATE OF BIRTH
    // ============================================================
    private string InterpretDob() {
        var raw = GetValue("date_of_birth");
        if (raw == "N/A") return "N/A";

        if (DateTime.TryParse(raw, out var dob))
            return dob.ToString("MMMM dd, yyyy");

        return raw;
    }

    private string InterpretCoverageDuration() {
        var raw = GetValue("coverage_duration");

        return raw switch {
            "short_term" => "Short-Term Coverage",
            "long_term" => "Long-Term Coverage",
            "lifetime" => "Lifetime Coverage",
            "unsure" => "Not Sure Yet",
            _ => "N/A"
        };
    }

    private string InterpretMonthlyBudget() {
        var raw = GetValue("monthly_budget");

        return raw switch {
            "under_25" => "Under $25/mo",
            "25_50" => "$25–$50/mo",
            "50_75" => "$50–$75/mo",
            "75_100" => "$75–$100/mo",
            "100_150" => "$100–$150/mo",
            "150_plus" => "Over $150/mo",
            _ => "N/A"
        };
    }


}


<!--ASSETS & LIABILITIES-->
@code {

    //-----------------------------------------------------------
    // GENERIC RANGE INTERPRETER
    //-----------------------------------------------------------
    private string InterpretRange(string key) {
        var raw = GetValue(key);

        return raw switch {
            "0_10k" => "None / Under $10k",
            "10k_25k" => "$10k – $25k",
            "25k_50k" => "$25k – $50k",
            "50k_100k" => "$50k – $100k",
            "100k_250k" => "$100k – $250k",
            "250k_plus" => "$250k+",
            _ => "N/A"
        };
    }

    //-----------------------------------------------------------
    // HOME OWNERSHIP
    //-----------------------------------------------------------
    private string InterpretHomeOwnership() {
        var v = GetValue("has_home_equity").ToLower();

        return v switch {
            "yes" => "Yes (Owner)",
            "no" => "No",
            _ => "N/A"
        };
    }

    //-----------------------------------------------------------
    // SAVINGS & INVESTMENTS (combined text)
    //-----------------------------------------------------------
    private string InterpretCombinedSavingsInvestments() {
        var savings = InterpretRange("savings_amount");
        var investments = InterpretRange("investments_amount");

        if (savings == "N/A" && investments == "N/A")
            return "N/A";

        return $"{savings}, {investments}";
    }
}


@using ConversaCore.TopicFlow
@using InsuranceAgent.Extensions

<div id="my-information-panel" class="tab-content p-8 @(ActiveTab != "my-information" ? "hidden" : "")">

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
        <div>
            <h2 class="text-2xl font-bold text-gray-900">Client Information Summary</h2>
            <p class="text-sm text-gray-600 mt-1">
                Review all information provided by @Context.GetString("lead_name") during the consultation
            </p>
        </div>

        <div class="flex items-center space-x-3">
            <button class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:border-gray-400 transition-colors">
                <i class="fa-solid fa-print mr-2"></i>
                Print Summary
            </button>
            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                <i class="fa-solid fa-download mr-2"></i>
                Export PDF
            </button>
        </div>
    </div>

    <!-- ========================= PERSONAL & CONTACT ========================= -->
    <div class="grid grid-cols-2 gap-6 mb-6">

        <!-- Personal Information -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center space-x-3 mb-5">
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                    <i class="fa-solid fa-user text-blue-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Personal Information</h3>
                    <p class="text-xs text-gray-500">Basic demographic details</p>
                </div>
            </div>

            <div class="space-y-4">
                @InfoRow("Full Name", Context.GetString("lead_name", "customer_name", "name"))
                @InfoRow("Date of Birth", Context.GetString("customer_dob", "date_of_birth", "dob"))
                @InfoRow("Age", Context.GetAge("customer_dob", "date_of_birth", "dob"))
                @InfoRow("Gender", Context.GetString("gender"))
                @InfoRow("Marital Status", Context.GetString("marital_status"))
                @InfoRow("State of Residence", Context.GetString("customer_city_state", "city_state", "state"))
            </div>
        </div>

        <!-- Contact Information -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center space-x-3 mb-5">
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                    <i class="fa-solid fa-envelope text-green-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Contact Information</h3>
                    <p class="text-xs text-gray-500">Communication preferences</p>
                </div>
            </div>

            <div class="space-y-4">
                @InfoRow("Email Address", Context.GetString("email", "customer_email", "lead_email"))
                @InfoRow("Phone Number", Context.GetString("phone", "customer_phone", "lead_phone"))
                @InfoRow("Address", Context.GetString("customer_address", "address", "street_address"))
                @InfoRow("City/State", Context.GetString("customer_city_state", "city_state"))
                @InfoRow("Preferred Contact Method", Context.GetString("preferred_contact_method", "contact_preference"))
                @InfoRow("Best Time to Contact", Context.GetString("best_time_to_contact", "contact_time"))
            </div>
        </div>

    </div>

    <!-- ====================== FINANCIAL & FAMILY ====================== -->
    <div class="grid grid-cols-2 gap-6 mb-6">

        <!-- Financial -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center space-x-3 mb-5">
                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                    <i class="fa-solid fa-dollar-sign text-purple-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Financial Information</h3>
                    <p class="text-xs text-gray-500">Income and coverage details</p>
                </div>
            </div>

            <div class="space-y-4">
                @InfoRow("Annual Income", Context.GetString("estimated_household_income", "household_income_band", "income"))
                @InfoRow("Employment Status", Context.GetString("employment_status"))
                @InfoRow("Occupation", Context.GetString("occupation"))
                @InfoRow("Can Afford Insurance", Context.GetBool("can_likely_afford_insurance") ? "Yes" : "No")
                @InfoRow("Desired Coverage Amount", Context.GetString("insurance_target", "parsed_insurance_target", "coverage_amount"))
                @InfoRow("Existing Coverage", Context.GetString("existing_coverage", "parsed_existing_coverage"))
                @InfoRow("Additional Coverage Needed", Context.GetString("additional_coverage_needed"))
            </div>
        </div>

        <!-- Family -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center space-x-3 mb-5">
                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                    <i class="fa-solid fa-users text-orange-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Family Information</h3>
                    <p class="text-xs text-gray-500">Dependents and beneficiaries</p>
                </div>
            </div>

            <div class="space-y-4">
                @InfoRow("Marital Status", Context.GetString("marital_status"))
                @InfoRow("Has Dependents", Context.GetBool("has_dependents") ? "Yes" : "No")
                @InfoRow("Number of Dependents", Context.GetString("estimated_number_of_dependents"))
                @InfoRow("Children Age Ranges", Context.GetString("selected_age_ranges"))
                @InfoRow("Young Children", Context.GetBool("has_young_children") ? "Yes" : "No")
                @InfoRow("Teenage Children", Context.GetBool("has_teenage_children") ? "Yes" : "No")
                @InfoRow("Adult Children", Context.GetBool("has_adult_children") ? "Yes" : "No")
                @InfoRow("Financial Responsibility Level", Context.GetString("financial_responsibility_level"))
            </div>
        </div>

    </div>

    <!-- ======================== HEALTH & GOALS ======================== -->
    <div class="grid grid-cols-2 gap-6 mb-6">

        <!-- Health -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center space-x-3 mb-5">
                <div class="w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center">
                    <i class="fa-solid fa-heart-pulse text-teal-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Health Information</h3>
                    <p class="text-xs text-gray-500">Medical history and lifestyle</p>
                </div>
            </div>

            <div class="space-y-4">
                @InfoRow("Overall Health Status", Context.GetString("health_risk_category"))
                @InfoRow("Tobacco Use", Context.GetBool("uses_tobacco") ? "Yes" : "No")
                @InfoRow("Pre-existing Conditions", Context.GetString("selected_medical_conditions"))
                @InfoRow("Number of Conditions", Context.GetString("number_of_medical_conditions"))
                @InfoRow("Height", Context.GetString("height"))
                @InfoRow("Weight", Context.GetString("weight"))
                @InfoRow("BMI", Context.GetString("calculated_bmi"))
                @InfoRow("BMI Category", Context.GetString("bmi_category"))
                @InfoRow("Premium Multiplier", Context.GetString("estimated_premium_multiplier"))
            </div>
        </div>

        <!-- Insurance Goals -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center space-x-3 mb-5">
                <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                    <i class="fa-solid fa-bullseye text-indigo-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Insurance Goals</h3>
                    <p class="text-xs text-gray-500">Coverage objectives and priorities</p>
                </div>
            </div>

            <div class="space-y-4">
                @InfoRow("Primary Goal Category", Context.GetString("primary_goal_category"))
                @InfoRow("Selected Goals", Context.GetString("selected_goals"))
                @InfoRow("Total Goals Selected", Context.GetString("total_goals_selected"))
                @InfoRow("Recommended Product", Context.GetString("recommended_product_type"))
                @InfoRow("Term Life Affinity", Context.GetString("term_life_affinity_score"))
                @InfoRow("Whole Life Affinity", Context.GetString("whole_life_affinity_score"))
                @InfoRow("Universal Life Affinity", Context.GetString("universal_life_affinity_score"))
                @InfoRow("Existing Life Insurance", Context.GetBool("has_existing_life_insurance") ? "Yes" : "No")
                @InfoRow("Coverage Type", Context.GetString("insurance_type"))
                @InfoRow("Coverage For", Context.GetString("coverage_for"))
            </div>
        </div>

    </div>

    <!-- ======================== QUALIFICATION & SCORING ======================== -->
    <div class="grid grid-cols-2 gap-6 mb-6">

        <!-- Lead Qualification -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center space-x-3 mb-5">
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                    <i class="fa-solid fa-chart-line text-green-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Lead Qualification</h3>
                    <p class="text-xs text-gray-500">Scoring and assessment</p>
                </div>
            </div>

            <div class="space-y-4">
                @InfoRow("Qualification Score", Context.GetString("lead_qualification_score"))
                @InfoRow("Qualification Grade", Context.GetString("lead_qualification_grade"))
                @InfoRow("Sales Priority Level", Context.GetString("sales_priority_level"))
                @InfoRow("Interest Level", Context.GetString("interest_level"))
                @InfoRow("Lead Intent", Context.GetString("lead_intent"))
                @InfoRow("Lead Source", Context.GetString("lead_source"))
                @InfoRow("Intent Clarity Score", Context.GetString("intent_clarity_score"))
                @InfoRow("Intent Clarity Level", Context.GetString("intent_clarity_level"))
            </div>
        </div>

        <!-- Data Quality -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="flex items-center space-x-3 mb-5">
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                    <i class="fa-solid fa-shield-check text-blue-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Data Quality</h3>
                    <p class="text-xs text-gray-500">Completeness and accuracy</p>
                </div>
            </div>

            <div class="space-y-4">
                @InfoRow("Lead Details Quality", Context.GetString("lead_details_data_quality_grade"))
                @InfoRow("Life Goals Quality", Context.GetString("goal_data_quality_grade"))
                @InfoRow("Insurance Context Quality", Context.GetString("insurance_context_data_quality_grade"))
                @InfoRow("Health Info Quality", Context.GetString("health_data_quality_grade"))
                @InfoRow("Employment Data Quality", Context.GetString("employment_data_quality_grade"))
                @InfoRow("Dependents Data Quality", Context.GetString("dependents_data_quality_grade"))
            </div>
        </div>

    </div>

    <!-- ========================== TIMELINE ========================== -->
    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl border border-blue-200 p-6">
        <div class="flex items-start space-x-4">
            <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fa-solid fa-clock-rotate-left text-white text-xl"></i>
            </div>

            <div class="flex-1">
                <h3 class="text-lg font-bold text-gray-900 mb-2">Information Collection Timeline</h3>

                <div class="grid grid-cols-4 gap-4 mt-4">
                    <div class="bg-white rounded-lg p-4">
                        <p class="text-xs text-gray-500 mb-1">Session Started</p>
                        <p class="text-sm font-semibold text-gray-900">@Context.GetString("StartTime", "session_start")</p>
                    </div>
                    <div class="bg-white rounded-lg p-4">
                        <p class="text-xs text-gray-500 mb-1">Last Updated</p>
                        <p class="text-sm font-semibold text-gray-900">@Context.GetString("last_update", "updated_at")</p>
                    </div>
                    <div class="bg-white rounded-lg p-4">
                        <p class="text-xs text-gray-500 mb-1">Follow-up Needed</p>
                        <p class="text-sm font-semibold text-gray-900">@(Context.GetBool("follow_up_needed") ? "Yes" : "No")</p>
                    </div>
                    <div class="bg-white rounded-lg p-4">
                        <p class="text-xs text-gray-500 mb-1">Has Valid Appointment</p>
                        <p class="text-sm font-semibold text-green-600">@(Context.GetBool("has_valid_appointment") ? "Yes" : "No")</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

</div>

@code {
    [Parameter] public TopicWorkflowContext Context { get; set; } = default!;
    [Parameter] public string ActiveTab { get; set; } = "";
    [Parameter] public List<ProductMatch>? MatchedProducts { get; set; }

    private RenderFragment InfoRow(string label, string value) => __builder => {
        <div class="flex items-start justify-between py-3 border-b border-gray-100">
            <div class="flex-1">
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">@label</p>
                <p class="text-sm font-semibold text-gray-900">@value</p>
            </div>
            <button class="text-blue-600 hover:text-blue-700 text-sm">
                <i class="fa-solid fa-pen-to-square"></i>
            </button>
        </div>
        ;
    };
}
@using System
@inherits ComponentBase

<div class="@($"bg-gradient-to-br {GradientClass} to-white border-2 {BorderClass} rounded-xl p-6 hover:border-blue-400 hover:shadow-lg transition-all cursor-pointer")">

    <!-- TOP INFO ROW -->
    <div class="flex items-start space-x-4 mb-4">

        <!-- Avatar -->
        <div class="relative flex-shrink-0">
            <img src="@Agent.AvatarUrl"
                 alt="@Agent.Name"
                 class="w-20 h-20 rounded-full border-4 border-white shadow-md" />

            <span class="@($"absolute bottom-0 right-0 w-5 h-5 {StatusDotClass} border-3 border-white rounded-full")"></span>
        </div>

        <!-- Agent Info -->
        <div class="flex-1">
            <p class="text-lg font-bold text-gray-900 mb-1">@Agent.Name</p>
            <p class="text-sm text-gray-600 mb-2">@Agent.Specialty</p>

            <!-- Rating Stars -->
            <div class="flex items-center text-sm text-yellow-500 mb-2">
                @for (int i = 0; i < FullStars; i++) {
                    <i class="fa-solid fa-star"></i>
                }

                @if (HasHalfStar) {
                    <i class="fa-solid fa-star-half-stroke"></i>
                }

                <span class="text-gray-600 ml-2 font-semibold">@Agent.Rating:F1</span>
            </div>

            <!-- Calls + Avg time -->
            <div class="flex items-center space-x-3 text-xs text-gray-600 mb-3">
                <span class="flex items-center">
                    <i class="fa-solid fa-phone-volume mr-1 text-blue-600"></i>
                    @Agent.Calls calls
                </span>
                <span class="flex items-center">
                    <i class="fa-solid fa-clock mr-1 text-blue-600"></i>
                    Avg @Agent.AvgMinutes min
                </span>
            </div>

            <!-- Availability Label -->
            <span class="@($"inline-flex items-center px-3 py-1 {StatusLabelClass} text-xs font-bold rounded-full")">
                <i class="@($"fa-solid fa-circle {StatusDotClass} mr-1 text-xs")"></i>
                @Agent.StatusLabel
            </span>
        </div>

    </div>

    <!-- ACTION BUTTON -->
    @if (Agent.IsAvailable) {
        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors">
            <i class="fa-solid fa-phone mr-2"></i>
            Connect with @Agent.Name
        </button>
    }
    else {
        <button disabled
                class="w-full bg-gray-300 text-gray-600 font-semibold py-3 rounded-lg cursor-not-allowed">
            <i class="fa-solid fa-clock mr-2"></i>
            Currently Busy
        </button>
    }

</div>


@code {

    [Parameter] public LiveAgent Agent { get; set; } = default!;

    // Derived (computed) values
    private int FullStars => (int)Math.Floor(Agent.Rating);
    private bool HasHalfStar => Agent.Rating - FullStars >= 0.5;

    // UI State classes depending on availability
    private string GradientClass =>
        Agent.IsAvailable ? "from-blue-50" : "from-yellow-50";

    private string BorderClass =>
        Agent.IsAvailable ? "border-blue-200" : "border-yellow-200";

    private string StatusDotClass =>
        Agent.IsAvailable ? "bg-green-500" : "bg-yellow-500";

    private string StatusLabelClass =>
        Agent.IsAvailable ? "bg-green-100 text-green-700" : "bg-yellow-100 text-yellow-700";
}
